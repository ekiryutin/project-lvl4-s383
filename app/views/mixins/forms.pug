- const isRequired = (f, property) => { const obj = f.model ? f.model[property] : null; return obj && obj.validate ? obj.validate.notEmpty : null; }

mixin formFor(f, options = {})
  - const url = _.get(options, 'url');
  - const method = _.get(options, 'method', 'get').toLowerCase();
  - const isStandart = _.includes(['get', 'post'], method);
  div.card.card-body.shadow-sm.pb-1
    form(action= url method= isStandart ? method : 'post')
      if !isStandart
        input(name='_method' type='hidden' value= method)
      block

mixin select(f, property, caption, list, options = { col: null })
  - const labelCol = options.col ? options.col.label : (defaultCol ? defaultCol.label : 'pt-0');
  - const inputCol = options.col ? options.col.input : (defaultCol ? defaultCol.input : '');
  label.col-form-label.text-muted(class=`${labelCol}`)= caption
  div(class= inputCol)
    - const value = f.object[property] === undefined ? '' : f.object[property]
    select.form-control(name= property)
      for item in list
        option(value=item.id selected=(item.id === Number(value)))= item.name

mixin autocomplete(f, property, caption, options = { url:'#', col: null })
  - const propertyId = `${property}Id`;
  - const propertyName = `${property}Name`;
  - const invalidClass = f.errors[propertyName] ? 'is-invalid' : '';
  - const labelCol = options.col ? options.col.label : (defaultCol ? defaultCol.label : 'pt-0');
  - const inputCol = options.col ? options.col.input : (defaultCol ? defaultCol.input : '');
  label.col-form-label.text-muted(class=`${labelCol}`)= caption
    if isRequired(f, propertyName) 
      sup.text-danger.pl-1 *
    block
  div(class= inputCol)
    - const _id = f.object[propertyId] === undefined ? '' : f.object[propertyId]
    - const _value = f.object[propertyName] === undefined ? '' : f.object[propertyName]
    input.form-control(name= propertyId id= propertyId autocomplete='off' type='hidden' value=_id)
    input.form-control.autocomplete(name= propertyName id= propertyName class=`${invalidClass}` autocomplete='off' data-source=options.url data-target=propertyId value=_value)
    if f.errors[propertyName]
      .invalid-feedback= f.errors[propertyName].map(({ message }) => message).join('. ')

mixin input(f, property, caption, options = { as: 'text', col: null, autofocus: false })
  - const invalidClass = f.errors[property] ? 'is-invalid' : '';
  - const labelCol = options.col ? options.col.label : (defaultCol ? defaultCol.label : 'pt-0');
  - const inputCol = options.col ? options.col.input : (defaultCol ? defaultCol.input : '');
  label.col-form-label.text-muted(class=`${labelCol}`)= caption
    if isRequired(f, property) 
      sup.text-danger.pl-1 *
  div(class= inputCol)
    - const value = f.object[property] === undefined ? '' : f.object[property]
    input.form-control(name= property id= property class=`${invalidClass}` autocomplete='off' autofocus=options.autofocus type=options['as'] value= value)
    if f.errors[property]
      .invalid-feedback= f.errors[property].map(({ message }) => message).join('. ')

mixin date(f, property, caption, options = { col: null, menu: null })
  - const invalidClass = f.errors[property] ? 'is-invalid' : '';
  - const labelCol = options.col ? options.col.label : (defaultCol ? defaultCol.label : 'pt-0');
  - const inputCol = options.col ? options.col.input : (defaultCol ? defaultCol.input : '');
  label.col-form-label.text-muted(class=`${labelCol}`)= caption
    if isRequired(f, property) 
      sup.text-danger.pl-1 *
  div.input-group(class= inputCol)
    - const value = f.object[property] === undefined ? '' : f.object[property]
    input.form-control.datepicker(name= property class=`${invalidClass}` autocomplete='off' type='text' value= value)
    .input-group-append
      button.btn.btn-outline-secondary(type='button' disabled=(!options.menu) data-toggle='dropdown' aria-haspopup='true' aria-expanded='false')
        i.fas.fa-calendar-day
      if options.menu
        .dropdown-menu
          .dropdown-item(href='#') завтра
          .dropdown-item(href='#') 3 дня
          .dropdown-item(href='#') неделю
          .dropdown-item(href='#') 10 дней
    if f.errors[property]
      .invalid-feedback= f.errors[property].map(({ message }) => message).join('. ')

mixin textarea(f, property, caption, rows = 3, options = { col: null })
  - const labelCol = options.col ? options.col.label : defaultCol.label;
  - const inputCol = options.col ? options.col.input : defaultCol.input;
  label.col-form-label.text-muted(class= labelCol)= caption
  div(class= inputCol)
    - const value = f.object[property] === undefined ? '' : f.object[property]
    textarea.form-control(name= property rows= rows)= value

mixin fileupload(target, attachTo)
    div.dm-uploader.p-4(id='drop-area' data-target= target  data-attach-to= attachTo)
     span.btn.btn-outline-primary
       span Выберите файл
       input(type='file' title='Click to add Files')
     span.pl-3.mb-4.mt-4.text-muted или перетащите файл сюда

//- ---------------------------

mixin inputText(value, caption, options = { col: null, inputClass: '' })
  - const labelCol = options.col ? options.col.label : defaultCol.label;
  - const inputCol = options.col ? options.col.input : defaultCol.input;
  label.col-form-label.text-muted(class= labelCol)= caption
  div(class= inputCol)
    .form-control.form-control-plaintext.border-bottom(class= options.inputClass)= value

mixin textareaText(value, caption, rows = 3, options = { col: null })
  - const labelCol = options.col ? options.col.label : defaultCol.label;
  - const inputCol = options.col ? options.col.input : defaultCol.input;
  label.col-form-label.text-muted(class= labelCol)= caption
  div(class= inputCol)
    textarea.form-control.form-control-plaintext.border-bottom(rows= rows)= value

mixin title(name, titleCol='', prevUrl = null)
  h4.mb-0
    if prevUrl
      //- возврат не работает после редактирования, потом доделать
      a.btn.btn-light.mr-1(href=prevUrl data-toggle='tooltip' title='Вернуться' data-placement='top')
        i.fas.fa-arrow-left.text-muted
    span.form_title.pr-2(class=titleCol)= name
    block

mixin formFooter(primaryName = 'Сохранить', referUrl)
  .form-group.text-right.pt-3
    a.btn.btn-light(href=(referUrl || referFor()) rel='noreferrer' id='btnCancel') Отменить
    button.btn.btn-default.btn-primary.pl-4.pr-4(type='submit' id='btnSubmit')
      //- .spinner-border.spinner-border-sm.mr-1.invisible
      = primaryName

mixin flashMessage(param)
  - const msg = flash.get()
  if msg
    .alert.alert-dismissible.fade.show(class=`alert-${msg.type}`)
      = msg.text
      button.close(type='button' data-dismiss='alert' area-label='Close')
        span(area-hidden='true') &times;

mixin toastMessage(param)
  //- const msg = { type: 'success', text: 'Задание сохранено успешно' };
  - const msg = flash.get()
  div.toast-container(style='position: fixed; z-index:10; top: 80px; right: 10px;')
    if msg
      .toast(role='alert' aria-live='assertive' aria-atomic='true' data-delay='5000')
        .toast-body(class=`text-${msg.type} callout-${msg.type}`)
          span.mr-1
            i.fas(class=(msg.icon || 'fa-check-circle'))
          = msg.text
          button.close.ml-2(type='button' data-dismiss='toast' area-label='Close' style='margin-top:-5px')
            small(area-hidden='true') &times;

mixin pagination(options)
  - var current = Number(options.pages.currentPage);
  div
    ul.pagination
      - const maxCount = Math.max(5, current);
      - var n = 1;
      while n <= Math.min(options.pages.pageCount, maxCount)
        - const isActive = (n === current ? 'active' : '');
        li.page-item(class= isActive)
          a.page-link(href= `${options.pages.searchurl}${n}`)= n++
      if n <= options.pages.pageCount && n >= maxCount
        a.page-link(href= `${options.pages.searchurl}${n}`) Далее
      //- li.text-muted.align-middle.pl-2= `Найдено: ${options.pages.recordCount} записей`

mixin buttonEdit(url, full)
  a.btn.btn-light(href= url data-toggle='tooltip' title=(full ? '' : 'Изменить') data-placement='top')
    i.fas.fa-pen.text-muted
    if full
      span.pl-2 Изменить

mixin buttonDelete(url, name)
  span(data-toggle='tooltip' title='Удалить' data-placement='top')
    button.btn.btn-light.btn-delete(type='button' data-toggle='modal' data-target= '#modalConfirmDelete' data-delete-url= url data-delete-name= name)
      i.fas.fa-trash-alt.text-muted

mixin confirmDelete()
  .modal.fade(id='modalConfirmDelete' tabindex='-1' role='dialog' area-hidden='true')
    .modal-dialog.modal-dialog-centered(rolde='document')
      .modal-content
        .modal-header
          h5.modal-title Подтверждение
          button(type='button' class='close' data-dismiss='modal' area-label='close')
            span(area-hidden='true') &times;
        .modal-body
          p(id='confirmDeleteMsg') Нужно задать параметры в buttonDelete
        .modal-footer
          button.btn.btn-light(type='button' data-dismiss='modal') Отменить
          a.btn.btn-outline-danger.pl-3.pr-3(id='confirmDeleteButton' href='#' data-method='delete' rel='nofollow') Удалить
          //- form(action= url method='post')
          //-   input(name='_method' type='hidden' value='delete')
          //-   button.btn.btn-warning.pl-3.pr-3(type='submit') Удалить
