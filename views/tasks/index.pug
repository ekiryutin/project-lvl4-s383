extends /layouts/application.pug

block define
  - const section = 'tasks';
  - const pageTitle = 'Задания';

block content
  //- параметры
  //-   tasks
  //-   pages
  //-   f: { name, object, errors }
  //-   statuses
  //-   access
  +title(pageTitle, 'col-xl-3 col-md-2 col-sm-3 pl-0')
    span.ml-2
      if access.new
        a.btn.btn-outline-primary(href= urlFor('newTask') Xstyle='margin-left: 40px')
          span.pl-1 Добавить

  .row
    .col-xl-3.mb-3

      +formFor(f, { url: urlFor('tasks'), method: 'get' })
        .row
          .col-md.col-lg.col-xl-12
            .form-group
              +select(f, 'statusId', 'Статус', statuses )
              //-div.btn-group(style='width:240px')
              //-  .btn.btn-outline-warning Новое
              //-  .btn.btn-outline-primary В работе
              //-  .btn.btn-outline-success Завершено

          .col-md.col-lg.col-xl-12
            .form-group
              +autocomplete(f, 'executor', 'Исполнитель', { url: urlFor('users.json') })
                if isSignedIn()
                  span.pos-right
                    script= `function setExecutor() {  executorId.value = '${userId()}'; executorName.value = '${userName()}'; btnSearch.click(); }`
                    .btn.footer-link.btn-sm(data-toggle='tooltip' title='Текущий пользователь' data-placement='top' onclick='setExecutor()')
                      i.fas.fa-user

          .col-md.col-lg.col-xl-12
            .form-group
              +autocomplete(f, 'author', 'Автор', { url: urlFor('users.json') })
                if isSignedIn()
                  span.pos-right
                    script= `function setAuthor() {  authorId.value = '${userId()}'; authorName.value = '${userName()}'; btnSearch.click(); }`
                    .btn.footer-link.btn-sm(data-toggle='tooltip' title='Текущий пользователь' data-placement='top' onclick='setAuthor()')
                      i.fas.fa-user

          .d-none.d-lg-block.col-lg.col-xl-12
            .form-group
              +input(f, 'tags', 'Теги')

          .col-auto.col-xl-12.text-right.mb-3
            div.d-xl-none
              label &nbsp;
            button.btn.btn-default.btn-primary.pl-4.pr-4(type='submit' id='btnSearch') Найти

    .col-xl-9

      table.table.border-left.border-right.table-hover.shadow-sm
        thead.thead-light.thead-sticky
          tr
            th(style='width: 5%') №
            th(style='width: 25%') Задание
            th(style='width: 15%') Срок
              span.text-muted.pl-2
                i.fas.fa-sort-down
            th(style='width: 15%') Статус
            th(style='width: 20%') Исполнитель
            th(style='width: 20%') Теги
        tbody.bg-white
          - const startFrom = (pages.currentPage - 1) * pages.pageSize + 1;
          - var n = startFrom;
          each task in tasks
            tr
              td= n++
              td
                a(href= urlFor('showTask', task.id))= task.name
              td= task.dateTo
              td
                //-.badge.badge-lg(class= `badge-${task.status.color}`)
                span.rounded.pl-2.pr-2.pb-1.pt-1(class= `state-${task.status.color}`)
                  = task.status.name
              td= task.executor.fullName
              td
              //-  each tag in tasks.tags
              //-    span= tag
          if n === startFrom
            tr
              td(colspan='6') Нет данных
      if pages.pageCount > 1
        +pagination({ url: urlFor('tasks'), pages })
